// Prisma Schema for Sigorta Yönetim Sistemi
// Generated from init.sql

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Role {
  id           BigInt   @id @default(autoincrement())
  name         String   @unique @db.VarChar(255)
  display_name String   @db.VarChar(255)
  description  String?  @db.Text
  created_at   DateTime? @default(now()) @db.Timestamp()
  updated_at   DateTime? @default(now()) @db.Timestamp()
  
  users        User[]
  
  @@map("roles")
}

model Dealer {
  id              BigInt    @id @default(autoincrement())
  dealer_name     String    @db.VarChar(255)
  contact_person  String?   @db.VarChar(255)
  phone           String    @db.VarChar(20)
  email           String?   @db.VarChar(255)
  address         String?   @db.Text
  city            String?   @db.VarChar(100)
  tax_number      String?   @db.VarChar(50)
  status          String    @default("active") @db.VarChar(20)
  created_at      DateTime? @default(now()) @db.Timestamp()
  updated_at      DateTime? @default(now()) @db.Timestamp()
  deleted_at      DateTime? @db.Timestamp()
  
  users           User[]
  customers       Customer[]
  
  @@map("dealers")
}

model User {
  id                BigInt    @id @default(autoincrement())
  name              String    @db.VarChar(255)
  email             String?   @unique @db.VarChar(255)
  phone             String?   @unique @db.VarChar(20)
  tc_no             String?   @unique @db.VarChar(11)
  email_verified_at DateTime? @db.Timestamp()
  password          String    @db.VarChar(255)
  role_id           BigInt
  dealer_id         BigInt?
  is_active         Boolean   @default(true)
  last_login_at     DateTime? @db.Timestamp()
  remember_token    String?   @db.VarChar(100)
  created_at        DateTime? @default(now()) @db.Timestamp()
  updated_at        DateTime? @default(now()) @db.Timestamp()
  
  role              Role       @relation(fields: [role_id], references: [id], onDelete: Restrict)
  dealer            Dealer?    @relation(fields: [dealer_id], references: [id], onDelete: SetNull)
  
  documents_uploaded      Document[]              @relation("uploaded_by")
  documents_approved      Document[]              @relation("approved_by")
  payments_recorded       Payment[]               @relation("recorded_by")
  notes                   Note[]
  notifications           Notification[]
  claims_handled          Claim[]                 @relation("handled_by")
  accounting_transactions AccountingTransaction[] @relation("accounting_created_by")
  
  @@map("users")
}

model FileType {
  id                     BigInt     @id @default(autoincrement())
  name                   String     @unique @db.VarChar(255)
  description            String?    @db.Text
  required_for_approval  Boolean    @default(false)
  created_at             DateTime?  @default(now()) @db.Timestamp()
  updated_at             DateTime?  @default(now()) @db.Timestamp()
  
  customers              Customer[]
  required_documents     RequiredDocument[]
  
  @@map("file_types")
}

model RequiredDocument {
  id                BigInt    @id @default(autoincrement())
  file_type_id      BigInt
  document_name     String    @db.VarChar(255)
  display_order     Int       @default(0)
  created_at        DateTime? @default(now()) @db.Timestamp()
  updated_at        DateTime? @default(now()) @db.Timestamp()
  
  file_type         FileType  @relation(fields: [file_type_id], references: [id], onDelete: Cascade)
  
  @@unique([file_type_id, document_name])
  @@map("required_documents")
}

model ResultDocumentType {
  id                BigInt     @id @default(autoincrement())
  name              String     @unique @db.VarChar(255)
  description       String?    @db.Text
  display_order     Int        @default(0)
  created_at        DateTime?  @default(now()) @db.Timestamp()
  updated_at        DateTime?  @default(now()) @db.Timestamp()
  
  documents         Document[]
  
  @@map("result_document_types")
}

model Customer {
  id                      BigInt    @id @default(autoincrement())
  ad_soyad                String    @db.VarChar(255)
  tc_no                   String    @unique @db.VarChar(11)
  telefon                 String    @db.VarChar(20)
  email                   String?   @db.VarChar(255)
  plaka                   String    @db.VarChar(20)
  hasar_tarihi            DateTime  @db.Date
  file_type_id            BigInt
  dealer_id               BigInt?
  başvuru_durumu          String    @default("İnceleniyor") @db.VarChar(100)
  evrak_durumu            String    @default("Eksik") @db.VarChar(20)
  dosya_kilitli           Boolean   @default(false)
  dosya_kapanma_nedeni    String?   @db.Text
  dosya_kapanma_tarihi    DateTime? @db.Timestamp()
  notlar                  String?   @db.Text
  created_at              DateTime  @default(now()) @db.Timestamp()
  updated_at              DateTime  @default(now()) @db.Timestamp()
  
  file_type               FileType  @relation(fields: [file_type_id], references: [id], onDelete: Restrict)
  dealer                  Dealer?   @relation(fields: [dealer_id], references: [id], onDelete: SetNull)
  
  documents               Document[]
  payments                Payment[]
  notes                   Note[]
  policies                Policy[]
  claims                  Claim[]
  
  @@map("customers")
}

model Document {
  id                        BigInt              @id @default(autoincrement())
  customer_id               BigInt
  tip                       String              @db.VarChar(100)
  dosya_adı                 String              @db.VarChar(255)  // Actual DB column name
  dosya_yolu                String              @db.Text
  dosya_boyutu              BigInt?
  mime_type                 String?             @db.VarChar(255)
  durum                     String              @default("Beklemede") @db.VarChar(20)
  red_nedeni                String?             @db.Text
  document_type             String?             @default("Standart Evrak") @db.VarChar(100)
  is_result_document        Boolean             @default(false)
  result_document_type_id   BigInt?
  uploaded_by               BigInt
  onaylayan_id              BigInt?
  onay_tarihi               DateTime?           @db.Timestamp()
  created_at                DateTime            @default(now()) @db.Timestamp()
  updated_at                DateTime            @default(now()) @db.Timestamp()
  deleted_at                DateTime?           @db.Timestamp()
  
  customer                  Customer            @relation(fields: [customer_id], references: [id], onDelete: Cascade)
  uploader                  User                @relation("uploaded_by", fields: [uploaded_by], references: [id], onDelete: Restrict)
  approver                  User?               @relation("approved_by", fields: [onaylayan_id], references: [id], onDelete: SetNull)
  result_document_type      ResultDocumentType? @relation(fields: [result_document_type_id], references: [id], onDelete: SetNull)
  
  @@map("documents")
}

model Payment {
  id              BigInt    @id @default(autoincrement())
  customer_id     BigInt
  tarih           DateTime  @db.Date
  tutar           Decimal   @db.Decimal(12, 2)
  açıklama        String?   @db.Text
  durum           String    @default("Bekliyor") @db.VarChar(20)
  ödeme_yöntemi   String?   @db.VarChar(255)
  referans_no     String?   @db.VarChar(255)
  kaydeden_id     BigInt
  created_at      DateTime? @default(now()) @db.Timestamp()
  updated_at      DateTime? @default(now()) @db.Timestamp()
  deleted_at      DateTime? @db.Timestamp()
  
  customer        Customer  @relation(fields: [customer_id], references: [id], onDelete: Cascade)
  recorder        User      @relation("recorded_by", fields: [kaydeden_id], references: [id], onDelete: Restrict)
  
  @@map("payments")
}

model Note {
  id           BigInt    @id @default(autoincrement())
  customer_id  BigInt
  user_id      BigInt
  içerik       String    @db.Text
  is_important Boolean   @default(false)
  created_at   DateTime? @default(now()) @db.Timestamp()
  updated_at   DateTime? @default(now()) @db.Timestamp()
  
  customer     Customer  @relation(fields: [customer_id], references: [id], onDelete: Cascade)
  user         User      @relation(fields: [user_id], references: [id], onDelete: Cascade)
  
  @@map("notes")
}

model Notification {
  id         BigInt    @id @default(autoincrement())
  user_id    BigInt
  title      String    @db.VarChar(255)
  message    String    @db.Text
  type       String    @default("info") @db.VarChar(20)
  link       String?   @db.VarChar(255)
  is_read    Boolean   @default(false)
  read_at    DateTime? @db.Timestamp()
  created_at DateTime? @default(now()) @db.Timestamp()
  updated_at DateTime? @default(now()) @db.Timestamp()
  
  user       User      @relation(fields: [user_id], references: [id], onDelete: Cascade)
  
  @@map("notifications")
}

model Policy {
  id               BigInt    @id @default(autoincrement())
  customer_id      BigInt
  policy_number    String?   @unique @db.VarChar(255)
  policy_type      String    @db.VarChar(255)
  company          String    @db.VarChar(255)
  premium          Decimal   @db.Decimal(12, 2)
  coverage_amount  Decimal?  @db.Decimal(15, 2)
  start_date       DateTime  @db.Date
  end_date         DateTime  @db.Date
  status           String    @default("active") @db.VarChar(20)
  notes            String?   @db.Text
  created_at       DateTime? @default(now()) @db.Timestamp()
  updated_at       DateTime? @default(now()) @db.Timestamp()
  deleted_at       DateTime? @db.Timestamp()
  
  customer         Customer  @relation(fields: [customer_id], references: [id], onDelete: Cascade)
  
  @@map("policies")
}

model Claim {
  id               BigInt    @id @default(autoincrement())
  customer_id      BigInt
  claim_number     String?   @unique @db.VarChar(255)
  claim_date       DateTime  @db.Date
  incident_date    DateTime  @db.Date
  description      String    @db.Text
  claim_amount     Decimal?  @db.Decimal(15, 2)
  approved_amount  Decimal?  @db.Decimal(15, 2)
  status           String    @default("pending") @db.VarChar(20)
  rejection_reason String?   @db.Text
  handled_by       BigInt?
  approved_at      DateTime? @db.Timestamp()
  paid_at          DateTime? @db.Timestamp()
  created_at       DateTime? @default(now()) @db.Timestamp()
  updated_at       DateTime? @default(now()) @db.Timestamp()
  deleted_at       DateTime? @db.Timestamp()
  
  customer         Customer  @relation(fields: [customer_id], references: [id], onDelete: Cascade)
  handler          User?     @relation("handled_by", fields: [handled_by], references: [id], onDelete: SetNull)
  
  @@map("claims")
}

model AccountingTransaction {
  id                BigInt    @id @default(autoincrement())
  type              String    @db.VarChar(20)
  category          String?   @db.VarChar(100)
  description       String?   @db.Text
  amount            Decimal   @db.Decimal(15, 2)
  transaction_date  DateTime  @db.Date
  document_url      String?   @db.Text
  created_by        BigInt
  created_at        DateTime? @default(now()) @db.Timestamp()
  updated_at        DateTime? @default(now()) @db.Timestamp()
  
  creator           User      @relation("accounting_created_by", fields: [created_by], references: [id], onDelete: Restrict)
  
  @@map("accounting_transactions")
}

// Laravel/Next.js system tables
model PersonalAccessToken {
  id             BigInt    @id @default(autoincrement())
  tokenable_type String    @db.VarChar(255)
  tokenable_id   BigInt
  name           String    @db.VarChar(255)
  token          String    @unique @db.VarChar(64)
  abilities      String?   @db.Text
  last_used_at   DateTime? @db.Timestamp()
  expires_at     DateTime? @db.Timestamp()
  created_at     DateTime? @db.Timestamp()
  updated_at     DateTime? @db.Timestamp()
  
  @@index([tokenable_type, tokenable_id])
  @@map("personal_access_tokens")
}

model Job {
  id           BigInt  @id @default(autoincrement())
  queue        String  @db.VarChar(255)
  payload      String  @db.Text
  attempts     Int     @db.SmallInt
  reserved_at  Int?
  available_at Int
  created_at   Int
  
  @@index([queue])
  @@map("jobs")
}

model Cache {
  key        String @id @db.VarChar(255)
  value      String @db.Text
  expiration Int
  
  @@map("cache")
}

model CacheLock {
  key        String @id @db.VarChar(255)
  owner      String @db.VarChar(255)
  expiration Int
  
  @@map("cache_locks")
}

model Session {
  id            String  @id @db.VarChar(255)
  user_id       BigInt?
  ip_address    String? @db.VarChar(45)
  user_agent    String? @db.Text
  payload       String  @db.Text
  last_activity Int
  
  @@index([user_id])
  @@index([last_activity])
  @@map("sessions")
}

